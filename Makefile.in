NAME=libnrcore
CC=@CC@
DEFS = @DEFS@
STD_CFLAGS=@ARCH@ -c -Wall -g3 -gdwarf-2 -D DEBUG -I$(shell pwd) $(DEFS)
STD_LDFLAGS=
SOURCES=$(shell for file in `@TOOLPATH@find ./libnrcore \( @EXCLUDE@ \) -prune -o -type f -name *.cpp -print`;do echo $$file; done)
HEADERS=$(shell for file in `@TOOLPATH@find ./libnrcore \( @EXCLUDE@ \) -prune -o -type f -name *.h` -print;do echo $$file; done)
OBJECTS=$(subst libnrcore,build,$(SOURCES:.cpp=.o))
BUILDPATH=./build
INSTALL_HEADER_PATH=/usr/local/include/$(NAME)
INSTALL_LIB_PATH=/usr/local/lib
DST_HEADERS=$(subst ./libnrcore,$(INSTALL_HEADER_PATH),$(HEADERS))
STATIC_LIBRARY=$(NAME).a

all: $(SOURCES) $(STATIC_LIBRARY)
	
$(STATIC_LIBRARY): $(OBJECTS)
	ar rcs $(BUILDPATH)/$@ $(addprefix $(BUILDPATH)/, $(notdir $(OBJECTS)))

$(BUILDPATH)/%.o:
	+@[ -d $(BUILDPATH) ] || mkdir -p $(BUILDPATH)
	$(CC) $(STD_CFLAGS) $(CFLAGS) ./$(subst build,libnrcore,$(@:.o=.cpp)) -o $(BUILDPATH)/$(notdir $@)

install:$(DST_HEADERS)
	mkdir -p $(INSTALL_HEADER_PATH)
	cp $(BUILDPATH)/$(STATIC_LIBRARY) $(INSTALL_LIB_PATH)/$(STATIC_LIBRARY)

$(DST_HEADERS):
	+@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	cp $(subst $(INSTALL_HEADER_PATH), ./libnrcore, $@) $@

clean:
	rm -Rf $(BUILDPATH)/*.o
	rm -f $(BUILDPATH)/$(STATIC_LIBRARY)

remove:
	rm -Rf $(INSTALL_HEADER_PATH)
	rm -f $(INSTALL_LIB_PATH)/$(STATIC_LIBRARY)

cleanconf:
	rm -Rf config.status
	rm -f config.log
	rm -f Makefile
